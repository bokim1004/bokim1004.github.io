{"componentChunkName":"component---src-templates-blog-post-js","path":"/react/react-query/","result":{"data":{"site":{"siteMetadata":{"title":"프론트엔드 로그 by 굥 🐳","author":"굥","siteUrl":"https://bokim1004.github.io","comment":{"disqusShortName":"https-bokim1004-github-io","utterances":"bokim1004/blog-comments"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"9dfaeff0-c6ee-56b7-aa0f-6ec8976255dd","excerpt":"React query를 쓰는 이유 다른 개발자들과 얘기를 하며, react query를 쓰는게 신세계라는 얘기를 들었는데요!\n이걸 한번도 안써봤다니!! 그래서 이번엔 react query에 대해 공부를 하며, 왜 react query를 쓰면 좋은지 정리해보았습니다.  React query는 원격 API에서 데이터 가져오는 과정을 간소화합니다.  React query…","html":"<h3 id=\"react-query를-쓰는-이유\" style=\"position:relative;\"><a href=\"#react-query%EB%A5%BC-%EC%93%B0%EB%8A%94-%EC%9D%B4%EC%9C%A0\" aria-label=\"react query를 쓰는 이유 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>React query를 쓰는 이유</h3>\n<p>다른 개발자들과 얘기를 하며, react query를 쓰는게 신세계라는 얘기를 들었는데요!\n이걸 한번도 안써봤다니!! 그래서 이번엔 react query에 대해 공부를 하며, 왜 react query를 쓰면 좋은지 정리해보았습니다.</p>\n<ol>\n<li><code class=\"language-text\">간편한 data fetching</code></li>\n</ol>\n<p>React query는 원격 API에서 데이터 가져오는 과정을 간소화합니다.</p>\n<ol start=\"2\">\n<li><code class=\"language-text\">캐싱 및 데이터 동기화</code></li>\n</ol>\n<p>React query는 자체적으로 캐싱 기능이 있어서 가져온 데이터를 로컬에 저장하고 다른 컴포넌트에 재사용할 수 있습니다.\n이런 캐싱 메커니즘은 불필요한 네트워크 요청을 줄여 퍼포먼스를 향상시킬 수 있습니다. 또한 자동적으로 데이터 동기화를 처리하여 캐시를 업데이트하고 일관성있게 유지합니다.</p>\n<ol start=\"3\">\n<li><code class=\"language-text\">자동 백그라운드 refetching</code></li>\n</ol>\n<p>react query를 사용하면 백그라운드 데이터 다시 가져오기를 쉽게할 수 있습니다. 다시 말해, 특정 간격을 설정하거나\n특정 조건에 따라 다시 가져오기를 트리거할 수 있으므로 명시적인 사용자 작업 없이도 데이터가 항상 최신 상태로 유지됩니다.</p>\n<ol start=\"4\">\n<li><code class=\"language-text\">Query 무효화, 오래된 데이터 관리</code></li>\n</ol>\n<p>React query는 똑똑한 캐시 무효화 매커니즘을 제공합니다. 서버에서 데이터가 변경될 때, react query는 자동적으로\n관련된 캐시를 업데이트하고, UI가 최신 데이터를 반영하는지 확인합니다. 또한 오래된 데이터 관리를 지원해서 백그라운드에서 최신 데이터를\n가져오는 동안 캐시된 데이터를 즉시 보여줄 수 있습니다.</p>\n<ol start=\"5\">\n<li><code class=\"language-text\">Optimistic 업데이트와 변형</code></li>\n</ol>\n<p>React query는 optimistic update를 제공하여 변형 과정(create,update,delete)을 간소화합니다.\n다시 말해, 실제 서버 응답받기 전에 낙관적으로 UI를 업데이트할 수 있는게 가능합니다.</p>\n<ol start=\"6\">\n<li><code class=\"language-text\">Error handling과 retries</code></li>\n</ol>\n<p>React query는 광범위한 에러 핸들링 기능을 가지고 있습니다. 오류를 처리하고 재시도할 수 있는 hook을 제공합니다.\nretry로직을 커스터마이즈할 수 있고, 에러 바운더리를 구현하여 에러 노티를 쉽게 보여줄 수 있습니다.</p>\n<ol start=\"7\">\n<li><code class=\"language-text\">React 생태계와의 통합</code></li>\n</ol>\n<p>React query는 리액트 생태계와 통합이 잘되고, redux 또는 mobX같은 상태 관리 라이브러리와도 호환가능합니다.</p>\n<p>예시 코드를 보며 react query를 사용하는 법을 살펴보았습니다.</p>\n<h3 id=\"usequery-예시\" style=\"position:relative;\"><a href=\"#usequery-%EC%98%88%EC%8B%9C\" aria-label=\"usequery 예시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useQuery 예시</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">userList</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> isLoading<span class=\"token punctuation\">,</span> isError <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">'users'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://api.example.com/users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>response<span class=\"token punctuation\">.</span>ok<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Failed to fetch users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isLoading<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>Loading<span class=\"token operator\">...</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isError<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>Error fetching users<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>User List<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>ul<span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">user</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n          <span class=\"token operator\">&lt;</span>li key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>user<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>user<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> userList<span class=\"token punctuation\">;</span></code></pre></div>\n<p>위 코드에서 react query를 사옹할 때, query는 <code class=\"language-text\">users</code>라고 정의했고 이는 <code class=\"language-text\">https://api.example.com/users</code> url에서\n유저 리스트를 가져옵니다.<br/>\nuseQuery는 2개의 arguments를 가지는데 <code class=\"language-text\">query key</code>와 <code class=\"language-text\">data를 가져오는 비동기 함수</code> 입니다.\n<code class=\"language-text\">query key</code>는 유니크한 쿼리 식별자이며, react query가 캐싱과 무효화를 관리하는데 도움을 주는 역할을 합니다.\n<br/></p>\n<p>query가 진행 중일 때, isLoading flag가 true가 되며, data를 가져올 때 에러가 있으면 isError flag가 true가 됩니다.\nquery가 성공적으로 데이터를 가져오면 user list를 보여주게 됩니다.</p>\n<p>React Query는 가져온 데이터를 캐싱하게 되는데, 만약 컴포넌트가 리렌더를 하면 react query는 캐시를 먼저 확인한 후 캐시된 데이터를 리턴합니다.\n만약 데이터가 오래되었거나 만료되었으면 react query는 자동적으로 백그라운드에서 refetch하여 cache와 UI를 업데이트합니다.</p>\n<h3 id=\"data-fetching-시-get에는-usequery가-사용되고-putpostdelete에는-usemutation이-사용된다\" style=\"position:relative;\"><a href=\"#data-fetching-%EC%8B%9C-get%EC%97%90%EB%8A%94-usequery%EA%B0%80-%EC%82%AC%EC%9A%A9%EB%90%98%EA%B3%A0-putpostdelete%EC%97%90%EB%8A%94-usemutation%EC%9D%B4-%EC%82%AC%EC%9A%A9%EB%90%9C%EB%8B%A4\" aria-label=\"data fetching 시 get에는 usequery가 사용되고 putpostdelete에는 usemutation이 사용된다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>data fetching 시 GET에는 useQuery가 사용되고, PUT,POST,DELETE에는 useMutation이 사용된다.</h3>\n<p>보통 <code class=\"language-text\">useQuery</code>는 데이터를 가져올 때 씁니다. 보통 HTTP METHOD GET요청처럼 서버에 저장된 상태를 불러와 사용할 떄 사용됩니다.\nuseQuery를 사용하면 데이터를 가져올 때 자동적으로 캐싱,리프레싱,에러핸들링 같은 것들을 해줍니다.\n반면, <code class=\"language-text\">useMutation</code>은 데이터 변형같은 데이터를 추가,업데이트,삭제하는 경우 사용됩니다.\n보통 HTTP METHOD POST, PUT, DELETE 요청처럼 서버에 사이드 이펙트를 발생시켜 서버상태를 변경시키는 경우 사용합니다.</p>\n<h3 id=\"usemutation-예시\" style=\"position:relative;\"><a href=\"#usemutation-%EC%98%88%EC%8B%9C\" aria-label=\"usemutation 예시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useMutation 예시</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">updateUser</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">userData</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/users'</span><span class=\"token punctuation\">,</span> userData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Failed to update user data'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Use the useMutation hook</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> mutate<span class=\"token punctuation\">,</span> isLoading<span class=\"token punctuation\">,</span> isError<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">,</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useMutation</span><span class=\"token punctuation\">(</span>updateUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Handle form submission</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleSubmit</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> formData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormData</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> userData <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">fromEntries</span><span class=\"token punctuation\">(</span>formData<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Call the mutation function to update user data</span>\n    <span class=\"token function\">mutate</span><span class=\"token punctuation\">(</span>userData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>useMutaion은 useQuery와 비슷한 방식으로 사용될 수 있습니다.\n비동기적으로 mutation을 실행하고, 에러핸들링도 합니다.</p>\n<h3 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치며</h3>\n<p>data fetching도 더 간편하고, 캐싱도 가능한다는 점에서 react query로 변경하는 작업을 해보면 좋을 것 같다는 생각이 들었습니다.\n특히, React query가 가지고 있는 기능 중 하나인 optimistic 업데이트를 실제로 활용해보면\n너무 좋을 것 같다는 생각이 들어서 이 부분을 좀 더 파고들어봐야할 것 같네요!</p>","frontmatter":{"title":"React query","date":"July 16, 2023","image":"https://velog.velcdn.com/images/chloeee/post/76582d94-ca32-41b5-a0aa-5e253eb45231/image.jpg"}}},"pageContext":{"slug":"/react/react-query/","previous":{"fields":{"slug":"/three.js/cameras/"},"frontmatter":{"title":"Three.js journey | Cameras"}},"next":{"fields":{"slug":"/three.js/fullscreen-and-resizing/"},"frontmatter":{"title":"Three.js journey | Fullscreen and resizing"}}}},"staticQueryHashes":["2486386679","3128451518"]}